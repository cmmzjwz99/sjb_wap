<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>世界杯</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <style>
        input,textarea,select{outline:none;}
        .item .match{
            width: 100%;
            border-bottom: 1px solid #c5c5c5;
            overflow:auto;
            text-align: center;
            box-sizing: border-box
        }
        .item .match .team{
            float: left;
            width: 25%;
            height: 120px;
            position: relative
        }
        .item .match .team .view{
            position: relative;
            top: 50%;
            transform: translateY(-50%);
        }
        .item .match .score{
            float: left;
            width: 5%;
            line-height: 120px;
            font-size: 20px
        }
        .item .match .content{
            float: left;
            width: 40%;
            height: 120px;
            position: relative
        }
        .item .match .content .view{
            position: relative;top: 50%;transform: translateY(-50%);
        }
        .item .game{
            background-color: #eeeeee;display: none
        }
        .item .game .game_item{
            position: relative;width: 100%;text-align: center;border-bottom: 1px solid #c5c5c5;overflow: hidden;
        }
        .item .game .game_item .head_name{
            width: 100%;height: 25px;line-height: 25px;font-size: 18px
        }
        .item .game .game_item .xiazhu_view{
            float: left;height: 40px;font-size: 10px;text-align: center;border-top:1px solid #dddddd;border-right:1px solid #dddddd;box-sizing: border-box
        }
        .item .game .game_item .xiazhu_view .xiazhu_btn{
            width: 40%;float: left;line-height: 40px;color: red
        }
        .header{
            position: fixed;
            z-index: 60;
            width: 100%;
            max-width: 700px;
            height: 40px;
            top: 0;
            background-color: white;
            text-align: center;
            line-height: 40px;
            box-shadow: 0 1px 2px #c5c5c5;
            font-size: 20px;
            margin-right: auto;
            margin-left: auto;
        }
        .date{
            height: 30px;line-height: 30px;padding-left: 10px;border-bottom: 1px solid #c5c5c5;font-size: 18px;box-sizing: border-box
        }
        .footer a{
            color: black;
        }
    </style>

</head>
<body>
<div class="app" style="max-width: 700px;margin-left: auto;margin-right: auto;position: relative;overflow: auto;padding-top: 40px">

    <div class="header">
        世界杯
    </div>
    <div id="main_data" style="padding-bottom: 60px">
    </div>
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" style="display: none" id="show_xiazhu">
    Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body" style="text-align: center">
                您选择是：<span id="trust"></span>
                <div>
                    <input type="text" id="point_val" placeholder="输入金币" style="border: 1px solid #cbcbcb" onkeyup="value=this.value.replace(/\D+/g,'')">
                </div>
                预计收益：<span id="get_point_val"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="order()">下注</button>
            </div>
        </div>
    </div>
</div>
<div class="footer" style="height: 40px;text-align: center;line-height: 40px">
    <div style="float:left;width: 33%;border: 1px solid #c5c5c5;box-sizing: border-box">竞猜</div>
    <a href="jcls.html">
    <div style="float:left;width: 34%;border: 1px solid #c5c5c5;box-sizing: border-box">竞猜历史</div>
    </a>
    <a href="chongzhi.html">
    <div style="float:left;width: 33%;border: 1px solid #c5c5c5;box-sizing: border-box">充值</div>
    </a>
</div>
</div>

<script src="js/main.js"></script>
<script>

    guoqi_imgs={
        '俄罗斯':'imgs/guoqi/eluosi.png',
        '沙特阿拉伯':'imgs/guoqi/shatealabo.png',
        '埃及':'imgs/guoqi/aiji.png',
        '乌拉圭':'imgs/guoqi/wulagui.png',
        '葡萄牙':'imgs/guoqi/putaoya.png',
        '西班牙':'imgs/guoqi/xibanya.png',
        '摩洛哥':'imgs/guoqi/moluoge.png',
        '伊朗':'imgs/guoqi/yilang.png',
        '法国':'imgs/guoqi/faguo.png',
        '澳大利亚':'imgs/guoqi/aodaliya.png',
        '秘鲁':'imgs/guoqi/milu.png',
        '丹麦':'imgs/guoqi/danmai.png',
        '阿根廷':'imgs/guoqi/agenting.png',
        '冰岛':'imgs/guoqi/bingdao.png',
        '克罗地亚':'imgs/guoqi/keluodiya.png',
        '尼日利亚':'imgs/guoqi/niriliya.png',
        '巴西':'imgs/guoqi/baxi.png',
        '瑞士':'imgs/guoqi/ruishi.png',
        '哥斯达黎加':'imgs/guoqi/gesidalijia.png',
        '塞尔维亚':'imgs/guoqi/saieweiya.png',
        '德国':'imgs/guoqi/deguo.png',
        '墨西哥':'imgs/guoqi/moxige.png',
        '瑞典':'imgs/guoqi/ruidian.png',
        '韩国':'imgs/guoqi/hanguo.png',
        '比利时':'imgs/guoqi/bilishi.png',
        '巴拿马':'imgs/guoqi/banama.png',
        '突尼斯':'imgs/guoqi/tunisi.png',
        '英格兰':'imgs/guoqi/yinggelan.png',
        '波兰':'imgs/guoqi/bolan.png',
        '塞内加尔':'imgs/guoqi/saineijiae.png',
        '哥伦比亚':'imgs/guoqi/gelunbiya.png',
        '日本':'imgs/guoqi/riben.png'
    }


    function show_item(view) {
        var id=$(view).attr('id')
        var match=$('#match_'+id)
        if(match.attr('data-show')=='false'){
            match.show()
            match.attr('data-show','true')
        }else{
            match.hide()
            match.attr('data-show','false')
        }
    }

    $('#point_val').bind('input propertychange', function() {
        $('#get_point_val').html(parseInt(parseInt($('#point_val').val().replace(/\D+/g,''))*par['odds']))
    });

    data=[]

    $(function () {
        $.ajax({
            url:'/api/accounts/login?user[login]=13868323606&user[password]=123456',
            type:'post',
            success:function (data) {
                console.log(data)
            }
        })
        $.ajax({
            url:'/api/quiz/list',
            type:'get',
            success:function (data) {
                data=data.data
                if(data.length>0){
                    for(i=0;i<data.length;i++){
                        $('#main_data').append(render.item(data[i]))
                    }
                }
                peilv()
            }
        })
    })

    function order() {
        if(parseInt($('#point_val').val().replace(/\D+/g,''))==0){
            alert('请输入金币')
            return
        }
        $.ajax({
            url:'/api/quiz/buy.json',
            type:'post',
            data:{order:{
                game_id:par['matchid'],
                team:par['winerid'],
                point:parseInt($('#point_val').val().replace(/\D+/g,''))
            }},
            success:function (data) {
                if(data.code==0){
                    alert('下注成功')
                    history.go(0)
                }else{
                    alert(data.msg)
                    if(data.code==2){
                        history.go(0)
                    }
                }
            }
        })
        console.log(par)
    }

    var par={}

    function xiazhu(matchid,winer,matchname,winerid,odds) {
        par['matchid']=matchid
        par['winerid']=winerid
        par['matchname']=matchname
        par['odds']=odds
        par['odds']=parseFloat($('#match_'+matchid+' .team_'+winerid).html())
        console.log(par)
        $('#myModalLabel').html(matchname)
        $('#trust').html(winer)
        $('.modal-body input').val('')
        $('#get_point_val').html('')
        $('#show_xiazhu').click()
    }

    function peilv() {
        $('#game_1234 .team_1').html(Math.random().toFixed(2))
        $('#game_1234 .team_2').html(Math.random().toFixed(2))
        $.ajax({
            url:'/api/quiz/odds.json',
            type:'get',
            success:function (data) {
                data=data.data
                if(data.length>0){
                    for(k=0;k<data.length;k++){
                        $('#game_'+data[k].id+' .team_1').html(data[k].odds1)
                        $('#game_'+data[k].id+' .team_2').html(data[k].odds2)
                        $('#game_'+data[k].id+' .team_3').html(data[k].odds3)
                    }
                }

                setTimeout(function(){ peilv() },10000)
            }
        })
    }
    var date=''
    var render={
        item:function (data) {
            str=''
            if(data.date!=date){
                str+='<div class="date">'+data.date+'</div>'
                date=data.date
            }
            str+='<div class="item"> <div class="match" id="'+data.id+'" onclick="show_item(this)">\
                <div class="team"> <div class="view"> \
                <img src="'+guoqi_imgs[data.team1]+'" style="width: 80%;max-width: 80px"> \
                <div>'+data.team1+'</div> </div> </div><div class="score score1">'+data.score1+'</div> <div class="content">\
                <div class="view"> <div>'+data.name+'</div> <div>'
            switch (data.status){
                case 0:{str+='未开始';break}
                case 1:{str+='可竞猜';break}
                case 2:{str+='进行中';break}
                case 3:{str+='已结束';break}
            }
            str+='</div> <div>'+data.time+' 开球</div>\
            </div> </div> <div class="score score2">'+data.score2+'</div> <div class="team"> <div class="view">\
                <img src="'+guoqi_imgs[data.team2]+'" style="width: 80%;max-width: 80px">\
                <div>'+data.team2+'</div> </div> </div> </div> <div id="match_'+data.id+'" class="game" data-show="false">'
            if(data.games.length>0){
                for(var j=0;j<data.games.length;j++){
                    str+=render.game(data.games[j],data.status)
                }
            }
            str+='</div> </div> '
            return str
        },
        game: function (data, status) {
            str = ' <div id="game_' + data.id + '" class="game_item"> '
            str+=' <div class="head_name">'+data.name+'</div> '
            if(status==1){
                if(data.category==3){
                    //3种结果情况
                    str+='<div class="xiazhu_view" style="width: 33.3333%;">\
                    <div style="width: 60%;float: left;line-height: 20px">\
                    <div>'+data.name1+'</div>\
                    <div><span class="team_1">'+data.odds1+'</span></div></div>\
                    <div class="xiazhu_btn" \
                    onclick="xiazhu(\''+data.id+'\',\''+data.name1+'\',\''+data.name+'\',1,'+data.odds1+')">\
                    下注 </div> </div>'
                    str+='<div class="xiazhu_view" style="width: 33.3333%;">\
                    <div style="width: 60%;float: left;line-height: 20px">\
                    <div>'+data.name2+'</div>\
                    <div><span class="team_2">'+data.odds2+'</span></div></div>\
                    <div class="xiazhu_btn" \
                    onclick="xiazhu(\''+data.id+'\',\''+data.name2+'\',\''+data.name+'\',2,'+data.odds2+')">\
                    下注 </div> </div>'
                    str+='<div class="xiazhu_view" style="width: 33.3333%;">\
                    <div style="width: 60%;float: left;line-height: 20px">\
                    <div>'+data.name3+'</div>\
                    <div><span class="team_3">'+data.odds3+'</span></div></div>\
                    <div class="xiazhu_btn" \
                    onclick="xiazhu(\''+data.id+'\',\''+data.name3+'\',\''+data.name+'\',3,'+data.odds3+')">\
                    下注 </div> </div>'
                }else{
                    //2种结果情况
                    str+='<div class="xiazhu_view" style="width: 50%;">\
                    <div style="width: 60%;float: left;line-height: 20px">\
                    <div>'+data.name1+'</div>\
                    <div><span class="team_1">'+data.odds1+'</span></div></div>\
                    <div class="xiazhu_btn" \
                    onclick="xiazhu(\''+data.id+'\',\''+data.name1+'\',\''+data.name+'\',1,'+data.odds1+')">\
                    下注 </div> </div>'
                    str+='<div class="xiazhu_view" style="width: 50%;">\
                    <div style="width: 60%;float: left;line-height: 20px">\
                    <div>'+data.name2+'</div>\
                    <div><span class="team_2">'+data.odds2+'</span></div></div>\
                    <div class="xiazhu_btn" \
                    onclick="xiazhu(\''+data.id+'\',\''+data.name2+'\',\''+data.name+'\',2,'+data.odds2+')">\
                    下注 </div> </div>'
                }
            }else{
                if(data.category==3){
                    //3种结果情况
                    str+='<div class="xiazhu_view" style="width: 33.3333%;">\
                    <div style="width: 100%;float: left;line-height: 20px">\
                    <div>'+data.name1+'</div>\
                    <div><span class="team_1">'+data.odds1+'</span></div></div> </div>'
                    str+='<div class="xiazhu_view" style="width: 33.3333%;">\
                    <div style="width: 100%;float: left;line-height: 20px">\
                    <div>'+data.name2+'</div>\
                    <div><span class="team_2">'+data.odds2+'</span></div></div> </div>'
                    str+='<div class="xiazhu_view" style="width: 33.3333%;">\
                    <div style="width: 100%;float: left;line-height: 20px">\
                    <div>'+data.name3+'</div>\
                    <div><span class="team_3">'+data.odds3+'</span></div></div> </div>'
                }else{
                    //2种结果情况
                    str+='<div class="xiazhu_view" style="width: 50%;">\
                    <div style="width: 100%;float: left;line-height: 20px">\
                    <div>'+data.name1+'</div>\
                    <div><span class="team_1">'+data.odds1+'</span></div></div></div>'
                    str+='<div class="xiazhu_view" style="width: 50%;">\
                    <div style="width: 100%;float: left;line-height: 20px">\
                    <div>'+data.name2+'</div>\
                    <div><span class="team_2">'+data.odds2+'</span></div></div> </div>'
                }
            }


            str+='</div>'
            return str
        }
    }
    </script>
</body>
</html>